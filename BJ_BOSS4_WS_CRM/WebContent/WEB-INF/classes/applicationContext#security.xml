<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:security="http://www.springframework.org/schema/security"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
	http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-2.0.4.xsd
	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd">
	
	<bean id="authAdvice" class="com.asiainfo.boss4.aspect.AuthAdvice" />
	<aop:config>
		<aop:aspect id="authAspect" ref="authAdvice">
			<aop:pointcut id="authActionPointcut" expression="execution(* com.asiainfo.boss4.action.*Impl.dispatch(..))"/>
			<aop:around pointcut-ref="authActionPointcut" method="authOnAction"/>
		</aop:aspect>
	</aop:config>
	
	<security:global-method-security>
		<security:protect-pointcut expression="execution(* com.asiainfo.boss4.action.*Impl.dispatch(..))" access="IS_AUTHENTICATED_FULLY" />
	</security:global-method-security>
	
	<!-- 
	<ldap-server url="ldap://usg-inter-ni.bmcc.com.cn:389/o=iappaccount,o=internal,dc=bmcc,dc=com,dc=cn" />
	<ldap-authentication-provider user-dn-pattern="uid={0},ou=people" /> -->
	
	<bean id="_authenticationManager" class="org.springframework.security.providers.ProviderManager">
		<property name="providers">
			<list>
				<ref bean="ldapAuthProvider"/>
			</list>
		</property>
	</bean>
	
	<bean id="ldapAuthProvider"
		class="org.springframework.security.providers.ldap.LdapAuthenticationProvider">
		<constructor-arg>
			<bean
				class="org.springframework.security.providers.ldap.authenticator.BindAuthenticator">
				<constructor-arg ref="contextSource" />
				<property name="userDnPatterns">
					<list>
						<value>uid={0},ou=people,o=employee</value>
						<value>uid={0},ou=people,o=iappaccount</value>
						<value>uid={0},ou=people,o=contract</value>
					</list>
				</property>
			</bean>
		</constructor-arg>
		<constructor-arg>
			<bean class="org.springframework.security.providers.ldap.LdapAuthenticationProvider$NullAuthoritiesPopulator" />
		</constructor-arg>
	</bean>
	
	<bean id="contextSource"
		class="org.springframework.security.ldap.DefaultSpringSecurityContextSource">
		<constructor-arg value="ldap://usg-inter-ni.bmcc.com.cn:389/o=internal,dc=bmcc,dc=com,dc=cn" />
	</bean>
	
</beans>